<section class="mapa-section">
  <div class="mapa-header">
    <h1>Productos en el Mapa</h1>
    <p>Localiza productos disponibles en Ecuador</p>
  </div>

  <!-- Map Container -->
  <div id="map" class="map-display"></div>

  <!-- Products List Card -->
  <div class="products-card">
    <div class="card-header">
      <h2>Productos Disponibles ({{ filteredProducts.length }})</h2>
      <button (click)="openFilters()" class="btn-filters">
        <i class="fas fa-sliders-h"></i> Filtros
      </button>
    </div>

    <div class="products-list">
      <div *ngIf="filteredProducts.length === 0" class="no-results">
        <p>No hay productos que coincidan con tus filtros.</p>
      </div>

      <div *ngFor="let product of filteredProducts" class="product-card">
        <div class="product-image-wrapper">
          <img
            [src]="product.image"
            [alt]="product.title"
            class="product-image"
            (error)="onImageError($event)"
          />
          <div class="image-fallback">
            <i class="fas fa-shopping-cart"></i>
          </div>
        </div>

        <div class="product-info">
          <h3>{{ product.title }}</h3>
          <p class="product-price">{{ formatPrice(product.price) }}</p>
          <div class="product-specs">
            <span><i class="fas fa-road"></i> {{ product.mileage.toLocaleString() }} km</span>
            <span><i class="fas fa-map-marker-alt"></i> {{ product.city }}</span>
            <span><i class="fas fa-calendar"></i> {{ product.year }}</span>
          </div>
        </div>

        <div class="product-actions">
          <button
            (click)="centerOnProduct(product)"
            class="btn-action btn-center"
            title="Centrar en mapa"
          >
            <i class="fas fa-bullseye"></i> Mapa
          </button>
          <button
            (click)="contactProduct(product)"
            class="btn-action btn-contact"
            title="Contactar"
          >
            <i class="fas fa-phone"></i> Contactar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters Modal -->
  <div *ngIf="showFilters" class="filters-modal-overlay" (click)="closeFilters()">
    <div class="filters-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Filtrar Productos</h2>
        <button (click)="closeFilters()" class="btn-close">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-content">
        <div class="filter-group">
          <label for="brand-filter">Categoría</label>
          <select [(ngModel)]="selectedBrand" id="brand-filter">
            <option value="">Todas las categorías</option>
            <option *ngFor="let brand of getBrands()" [value]="brand">{{ brand }}</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="price-min">Precio Mínimo: {{ formatPrice(minPrice) }}</label>
          <input
            [(ngModel)]="minPrice"
            type="range"
            id="price-min"
            min="0"
            max="100000"
            step="1000"
          />
        </div>

        <div class="filter-group">
          <label for="price-max">Precio Máximo: {{ formatPrice(maxPrice) }}</label>
          <input
            [(ngModel)]="maxPrice"
            type="range"
            id="price-max"
            min="0"
            max="100000"
            step="1000"
          />
        </div>

        <div class="filter-group">
          <label for="year-min">Año Mínimo: {{ minYear }}</label>
          <input [(ngModel)]="minYear" type="range" id="year-min" min="2010" max="2024" />
        </div>

        <div class="filter-group">
          <label for="radius">Radio de Búsqueda: {{ searchRadius }} km</label>
          <input [(ngModel)]="searchRadius" type="range" id="radius" min="10" max="500" step="10" />
        </div>
      </div>

      <div class="modal-footer">
        <button (click)="clearFilters()" class="btn-secondary">
          <i class="fas fa-undo"></i> Limpiar
        </button>
        <button (click)="applyFilters(); closeFilters()" class="btn-primary">
          <i class="fas fa-check"></i> Aplicar Filtros
        </button>
      </div>
    </div>
  </div>
</section>
